{
  "hash": "a471acdd21f735fc084c920962d21801",
  "result": {
    "markdown": "---\ntitle: \"Generate Sparsity Figures\"\nauthor: \"Natasha Santhanam\"\ndate: \"3/9/2022\"\noutput: html_document\n---\n\n\n\n## Subset genes used in prediction to those that have an analog in GTEx tissues\nwe will use this for comparison later\n\n::: {.cell}\n\n```{.r .cell-code}\noverlap <- read_tsv(data.dir %&% \"Box_files/overlap_rat_genes_GTEx.txt\", col_names = TRUE)  # genes that are present in both rat expression data and in GTEx\n\nexpr_Ac <- readRDS(data.dir %&% \"expression/Ac_expression_transformed.RDS\")\nexpr_Ac <- expr_Ac[, intersect(colnames(expr_Ac), overlap$rat_gene)]\nsaveRDS(expr_Ac, data.dir %&% \"expression/Ac_expression_intesrect_GTEx.RDS\")\n```\n:::\n\n\n\n## Generate R2 predictions for all elastic net parameters between 0 and 1\n\nWe run the same Prediction Model Pipeline only for Ac tissue. However this time, I didn't break it down into chromosome. This takes longer but means you have less files, a file for each alpha parameter. \n\n\n::: {.cell}\n\n```{.bash .cell-code}\nfor i in $(seq 0 0.1 1.0)\ndo\nqsub -v alpha=$i sparsity_rats_pipeline.pbs\ndone\n```\n:::\n\n\n\nNow we have predictability for all parameters of alpha. We can now iterate through all alphas and create the long data format. We also only select for genes that have an average cor > 0.3 and subsample 20 genes. \n\n::: {.cell}\n\n```{.r .cell-code}\nldf <- list() # creates a list\nlisttsv <- list.files(path = dir, pattern = \"working_TW_Ac_exp_10-foldCV_elasticNet_alpha\", full.names = TRUE) # creates the list of all the tsv files in the directory\ntempo <- read_tsv(listtsv[1], col_names = TRUE) \ntempo <- tempo %>% select(c(gene, cor))\ncolnames(tempo)[2] = \"0\"\n\nfor (k in 2:length(listtsv)){\n ldf[[k]] <- read_tsv(listtsv[k], col_names = TRUE)\n alpha <- substr(listtsv[k], 107, str_length(listtsv[k]) - 13)\n fila <- as.data.frame(ldf[[k]]) \n fila <- fila %>% select(c(gene, cor)) \n colnames(fila)[2] = alpha\n tempo <- inner_join(tempo, fila, by = \"gene\")\n}\n```\n:::\n\n\nPlot results of r for all parameers of alpha\n\n::: {.cell}\n\n```{.r .cell-code}\ntempo <- read_tsv(\"/Users/natashasanthanam/Downloads/rat_elastic_net_all_parameters_GTEx_only_genes.txt\", col_names = TRUE)\n\ndata_long <- tempo  %>%   pivot_longer(!gene, names_to = \"value\", values_to = \"count\")\n   \np1 <-  ggplot(data_long, aes(x = as.numeric(value), y = count)) + geom_smooth(show_guide = FALSE, se=T, size = .5, col = \"dodgerblue2\")  +  xlab(expression(paste(\"Elastic net mixing parameter (\",alpha, \")\"))) + ylab(expression(paste(\"10-fold cross-validated R\")))\n\np2 = ggplot(tempo, aes(x = `0`, y = `0.5`)) + geom_hex(bins = 50)   +\n      geom_abline(slope = 1, intercept = 0, color = \"darkgrey\", size = 0.8) +\n      ylab(\"cor for mixing paramter = 0.5\" ) +\n      xlab(\"cor for mixing paramter = 0\") + theme_bw(base_size = 16)\n\np1\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}