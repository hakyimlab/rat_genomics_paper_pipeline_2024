{
  "hash": "89184f04d6eac5224f5b87d51f0dc85f",
  "result": {
    "markdown": "---\ntitle: \"04.GEMMA_LMM_analysis\"\nauthor: \"Natasha Santhanam\"\ndate: \"4/21/2022\"\noutput: html_document\n---\n\n\n\n\n## Check gene level associations with GEMMA \n\nGemma uses a LMM with a kinship matrix. That would account for familial structure that PrediXcan doesnt. We'll run Gemma with the predicted expression and metabolic phenotypes to compare the results. \n\nWe first run GEMMA with predicted expression for Nucleus Accumbens Core Tissue generated by PrediXcan. We'll create GRMS first for all phenotypes\n\n# Create gemma format from predicted expression\n\n::: {.cell}\n\n```{.r .cell-code}\npred_expr <- fread(data.dir %&% \"prediXcan/metabolic_traits/rat_metabolic_Ac_best__predict.txt\") %>% select(-c(FID))\npred_expr <- pred_expr %>% pivot_longer(!IID, names_to = \"gene\", values_to = \"count\" ) \npred_expr <- pred_expr %>% pivot_wider(names_from = IID, values_from = count)\npred_expr <- pred_expr %>% mutate(ref = NA, .before = colnames(pred_expr)[1]) %>% mutate(eff = NA, .before = colnames(pred_expr)[1])) \nwrite_csv(pred_expr, \"/gpfs/data/im-lab/nas40t2/natasha/rat_genomics/GEMMA/Ac/LMM/Ac_pred_expr.bimbam\", col_names = FALSE)\n```\n:::\n\n\ncreate phenotype file\n\n::: {.cell}\n\n```{.r .cell-code}\npheno <- read_tsv(data.dir %&% \"Box_files/processed_obesity_rat_Palmer_phenotypes.tsv\")\nall_rats <- read_tsv(data.dir %&% \"Box_files/all_names.txt\", col_names = TRUE)\npheno <- pheno %>% filter(!(rat_rfid %in% all_rats$ID)) %>% select(-c(rat_rfid))\n\nwrite_tsv(pheno, data.dir %&% \"GEMMA/Ac/LMM/processed_obesity_phenotypes_GEMMA.tsv\", col_names =FALSE)\n```\n:::\n\n\ncreate SNP annotation file (we'll use gene annotation file for Rats)\n\n::: {.cell}\n\n```{.r .cell-code}\ngtf <- read_tsv(data.dir %&% \"Box_files/gtf.txt\", col_names = TRUE)\nannot <- tibble(gene = pred_expr$gene)\nannot <- annot %>% mutate(chr = gtf[na.omit(match(annot$gene, gtf$Gene)), 1]$Chr) %>% mutate(TSS = gtf[na.omit(match(annot$gene, gtf$Gene)), 4]$Start)\n\n#write_tsv(annot, data.dir %&% \"GEMMA/Ac/LMM/gene_annotation.tsv\", col_names = FALSE)\n```\n:::\n\n\n\nuse gemma/0.98.1 to create GRM kinship matrix\n\n::: {.cell}\n\n```{.r .cell-code}\ngemma.dir <- data.dir %&% \"GEMMA/Ac/LMM/\"\nsetwd(data.dir %&% \"GEMMA/Ac/LMM/GRM/\")\nfor(i in 1:ncol(pheno)) {\ntrait <- colnames(pheno)[i]\nrunGEMMAgrm <- \"gemma -g \" %&%  gemma.dir %&% \"Ac_pred_expr.bimbam\" %&%  \" -p \" %&% gemma.dir %&% \"processed_obesity_phenotypes_GEMMA.tsv\" %&% \" -n \" %&% i %&%  \" -notsnp -gk -o \" %&% \"grm_Ac_\" %&% trait\nsystem(runGEMMAgrm)\n}\n\ngemma -g [filename] -p [filename] -a [filename] -k [filename] -lmm [num] -o [prefix]\n```\n:::\n\n\nRun Univariate Linear Mixed model\n\n::: {.cell}\n\n```{.r .cell-code}\nout.dir <- \"/gpfs/data/im-lab/nas40t2/natasha/rat_genomics/GEMMA/Ac/LMM/GRM/output/\"\nsetwd(data.dir %&% \"GEMMA/Ac/LMM/assoc/\")\nfor(i in 2:ncol(pheno)) {\n  trait <- colnames(pheno)[i]\n  runGEMMAgrm <- \"gemma -g \" %&%  gemma.dir %&% \"Ac_pred_expr.bimbam\" %&%  \" -p \" %&% gemma.dir %&% \"processed_obesity_phenotypes_GEMMA.tsv\" %&% \" -a \" %&% gemma.dir %&% \"gene_annotation.tsv\"  %&% \" -n \" %&% i %&%  \" -lmm 1 \" %&% \" -k \" %&% out.dir %&%  \"grm_Ac_\" %&% trait %&% \".cXX.txt -o \" %&% \"assoc_Ac_\" %&% trait\n  system(runGEMMAgrm)\n}\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}